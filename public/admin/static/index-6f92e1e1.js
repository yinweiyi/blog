import{a as e,g as a,u as l,s as t,d as o}from"./index-20ea9ccb.js";import{b as r,a as d,r as u,e as n,U as s,h as i,i as p,w as c,f as m,o as g,l as f,F as v,p as b,j as _,A as h,m as y,W as w,a8 as V,z as k,a9 as x,aa as C,B as D,E as U,_ as j}from"./index-2fc42248.js";const S={class:"app-container"},q=r({name:"Category"}),z=r({...q,props:{category:{type:Object,required:!0},showDialog:{type:Boolean,required:!0,default:!1}},emits:["update:showDialog","update:category","handleSubmit"],setup(a,{emit:l}){const t=a,o=d([{label:"----顶级分类----",value:0}]),r=u({isShowDialog:t.showDialog,loading:!1}),y=n((()=>t.category)),w=e=>{l("update:showDialog",!1),e()};s((()=>{(async()=>{const{data:a}=await e();o.value=o.value.concat(a.map((e=>({label:e.name,value:e.id}))))})()}));const V=d(null),k=u({name:[{required:!0,message:"分类名不能为空",trigger:"blur"}],slug:[{required:!0,message:"标识不能为空",trigger:"blur"},{min:2,max:20,message:"长度必须在 2 到 20 位之间",trigger:"blur"}]}),x=()=>{var e;null==(e=V.value)||e.validate((e=>{if(!e)return!1;l("update:category",y.value),l("handleSubmit")}))},C=()=>{l("update:showDialog",!1)};return(e,a)=>{const l=m("el-option"),t=m("el-select"),d=m("el-form-item"),u=m("el-input"),n=m("el-input-number"),s=m("el-form"),D=m("el-button"),U=m("el-card"),j=m("el-dialog");return g(),i("div",S,[p(j,{modelValue:r.isShowDialog,"onUpdate:modelValue":a[5]||(a[5]=e=>r.isShowDialog=e),title:"分类","before-close":w},{default:c((()=>[p(U,{shadow:"never"},{default:c((()=>[p(s,{model:f(y),ref_key:"formRef",ref:V,"label-position":"right","label-width":"100px",rules:k},{default:c((()=>[p(d,{label:"父分类：",prop:"parent_id"},{default:c((()=>[p(t,{placeholder:"请选择分类",modelValue:f(y).parent_id,"onUpdate:modelValue":a[0]||(a[0]=e=>f(y).parent_id=e)},{default:c((()=>[(g(!0),i(v,null,b(o.value,(e=>(g(),_(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(d,{label:"分类名：",prop:"name"},{default:c((()=>[p(u,{class:"form-input",modelValue:f(y).name,"onUpdate:modelValue":a[1]||(a[1]=e=>f(y).name=e),placeholder:"请输入分类名"},null,8,["modelValue"])])),_:1}),p(d,{label:"标识：",prop:"slug"},{default:c((()=>[p(u,{class:"form-input",modelValue:f(y).slug,"onUpdate:modelValue":a[2]||(a[2]=e=>f(y).slug=e),placeholder:"请输入标识"},null,8,["modelValue"])])),_:1}),p(d,{label:"排序：",prop:"order"},{default:c((()=>[p(n,{class:"form-input",modelValue:f(y).order,"onUpdate:modelValue":a[3]||(a[3]=e=>f(y).order=e)},null,8,["modelValue"])])),_:1}),p(d,{label:"描述：",prop:"description"},{default:c((()=>[p(u,{class:"form-input",modelValue:f(y).description,"onUpdate:modelValue":a[4]||(a[4]=e=>f(y).description=e),placeholder:"输入描述",type:"textarea"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),p(d,{style:{"padding-left":"150px"}},{default:c((()=>[p(D,{type:"primary",onClick:x},{default:c((()=>[h("保存")])),_:1}),p(D,{style:{"margin-left":"10px"},onClick:C},{default:c((()=>[h("取消")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])}}}),O={class:"app-container"},A={class:"toolbar-wrapper"},B={class:"table-wrapper"},E=r({name:"Categories"}),F=j(r({...E,setup(e){const r=d(!1),u=d(!1),n=d([]);y();const v={id:0,parent_id:0,order:0,name:"",slug:"",description:""},b=d(Object.assign({},v)),j=e=>{b.value=Object.assign({},v),b.value.parent_id=e,u.value=!0},S=()=>{b.value.id>0?l(b.value.id,b.value).then((()=>{U.success("更新成功"),u.value=!1,q()})):t(b.value).then((()=>{U.success("添加成功"),u.value=!1,q()}))},q=()=>{r.value=!0,a().then((e=>{n.value=e.data})).catch((()=>{n.value=[]})).finally((()=>{r.value=!1}))};return s((()=>{q()})),(e,a)=>{const l=m("el-button"),t=m("el-table-column"),d=m("el-popconfirm"),s=m("el-table"),v=m("el-card"),y=V("loading");return g(),i("div",O,[w((g(),_(v,{shadow:"never"},{default:c((()=>[k("div",A,[k("div",null,[p(l,{type:"primary",icon:f(x),onClick:a[0]||(a[0]=e=>j(0))},{default:c((()=>[h("新增分类")])),_:1},8,["icon"])])]),k("div",B,[p(s,{data:n.value,"row-key":"id",border:"","default-expand-all":""},{default:c((()=>[p(t,{prop:"name",label:"分类名",align:"center"}),p(t,{prop:"slug",label:"标识",align:"center"}),p(t,{prop:"order",label:"排序",align:"center",sortable:""}),p(t,{prop:"created_at",label:"创建时间",align:"center"}),p(t,{fixed:"right",label:"操作",width:"240"},{default:c((({row:e})=>[p(l,{type:"primary",text:"",bg:"",size:"small",onClick:a=>(e=>{const{id:a,parent_id:l,order:t,name:o,slug:r,description:d}=e;b.value={id:a,parent_id:l,order:t,name:o,slug:r,description:d},u.value=!0})(e)},{default:c((()=>[h("编辑")])),_:2},1032,["onClick"]),0===e.children.length?(g(),_(d,{key:0,icon:f(C),"icon-color":"#626AEF",title:"真的要删除此条数据吗？",onConfirm:a=>(e=>{o(e.id).then((()=>{U.success("删除成功"),q()}))})(e)},{reference:c((()=>[p(l,{type:"danger",text:"",bg:"",size:"small"},{default:c((()=>[h("删除")])),_:1})])),_:2},1032,["icon","onConfirm"])):D("",!0),0===e.parent_id?(g(),_(l,{key:1,type:"default",text:"",bg:"",size:"small",onClick:a=>j(e.id)},{default:c((()=>[h(" 添加子类 ")])),_:2},1032,["onClick"])):D("",!0)])),_:1})])),_:1},8,["data"]),u.value?(g(),_(z,{key:0,"show-dialog":u.value,"onUpdate:showDialog":a[1]||(a[1]=e=>u.value=e),category:b.value,"onUpdate:category":a[2]||(a[2]=e=>b.value=e),onHandleSubmit:S},null,8,["show-dialog","category"])):D("",!0)])])),_:1})),[[y,r.value]])])}}}),[["__scopeId","data-v-ebf5e0bf"]]);export{F as default};
